"use strict";(()=>{var e={};e.id=780,e.ids=[780],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6912:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>T,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>p,dynamic:()=>u,runtime:()=>o});var i=r(9303),a=r(8716),n=r(670);let o="nodejs",u="force-dynamic";async function d(e,t,r){let s;let i=e.replace(/\/?$/,"/")+`${t}.json`,a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await a.text();try{s=JSON.parse(n)}catch{s={raw:n}}return!a.ok||s?.error?{ok:!1,status:a.status,error:s?.error||n,data:s}:{ok:!0,status:a.status,data:s}}async function p(e){let t=process.env.BITRIX_WEBHOOK_BASE;if(!t)return new Response(JSON.stringify({ok:!1,error:"BITRIX_WEBHOOK_BASE not set"}),{status:500});let r=await e.json(),s=r?.task,i=Number(r?.tzOffsetMinutes),a=Number(process.env.BITRIX_TZ_OFFSET_MINUTES??0),n=Array.isArray(s?.assignees)&&s.assignees.length?s.assignees:s?.assignee?[s.assignee]:[],o={TITLE:s?.title||"",DESCRIPTION:s?.description||"",ACCOMPLICES:(s?.coAssignees||[]).map(e=>Number(e.id)).filter(e=>Number.isFinite(e)),AUDITORS:(s?.observers||[]).map(e=>Number(e.id)).filter(e=>Number.isFinite(e)),PRIORITY:s?.isImportant?2:1,TASK_CONTROL:s?.requireResult?"Y":"N"};if(s?.dueDate&&Number.isFinite(i)){let e=function(e,t,r){let s=e.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/);if(!s)return;let[i,a,n,o,u,d]=s,p=parseInt(a,10),l=parseInt(n,10)-1,c=new Date(Date.UTC(p,l,parseInt(o,10),parseInt(u,10),parseInt(d,10))-6e4*t+6e4*r),m=e=>String(e).padStart(2,"0");return`${c.getUTCFullYear()}-${m(c.getUTCMonth()+1)}-${m(c.getUTCDate())}T${m(c.getUTCHours())}:${m(c.getUTCMinutes())}:00`}(s.dueDate,i,Number.isFinite(a)?a:i);e&&(o.DEADLINE=e)}let u=Array.isArray(s?.checklist)?s.checklist:[],p=[];for(let e of n.length?n:[{id:void 0}]){let r={...o,RESPONSIBLE_ID:e?.id?Number(e.id):void 0},s=await d(t,"tasks.task.add",{fields:r});if(!s.ok){p.push(s);continue}let i=s.data,a=i?.result?.task?.id??i?.result?.taskId??("number"==typeof i?.result||"string"==typeof i?.result?i.result:void 0);if(a&&u.length){let e=10;for(let r of u){let s={TASKID:Number(a),FIELDS:{TITLE:String(r.text||"").trim()||"---",IS_COMPLETE:r.done?"Y":"N",SORT_INDEX:e}};e+=10,await d(t,"task.checklistitem.add",s)}}p.push({ok:!0,taskId:a})}return new Response(JSON.stringify({ok:p.every(e=>e.ok),results:p}),{status:200})}let l=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/bitrix/tasks/add/route",pathname:"/api/bitrix/tasks/add",filename:"route",bundlePath:"app/api/bitrix/tasks/add/route"},resolvedPagePath:"/Users/user/Desktop/b24-regular-task/app/api/bitrix/tasks/add/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:T}=l,I="/api/bitrix/tasks/add/route";function g(){return(0,n.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:m})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948],()=>r(6912));module.exports=s})();