"use strict";(()=>{var e={};e.id=669,e.ids=[669],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9705:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>l,dynamic:()=>u,runtime:()=>o});var i=r(9303),a=r(8716),n=r(670);let o="nodejs",u="force-dynamic";function p(e){let t=[e?.NAME,e?.LAST_NAME].filter(Boolean).join(" ").trim(),r=(e?.EMAIL||e?.WORK_EMAIL||"").trim();return{id:String(e?.ID??""),name:t||r||"Без имени",email:r,active:"Y"===String(e?.ACTIVE??"Y")}}async function c(e){let t;let r=e.endsWith("/")?e:e+"/",s=[];for(;;){let e=new URL(r+"user.get.json");e.searchParams.set("FILTER[ACTIVE]","Y"),void 0!==t&&e.searchParams.set("start",String(t));let i=await fetch(e,{cache:"no-store",method:"POST"});if(!i.ok)throw Error(`Bitrix error ${i.status}`);let a=await i.json();if(s.push(...a?.result??[]),a?.next!==void 0)t=a.next;else break}return s}async function l(){let e=process.env.BITRIX_WEBHOOK_BASE;if(!e)return new Response(JSON.stringify({error:"BITRIX_WEBHOOK_BASE not set"}),{status:500});try{let t=(await c(e)).map(p).filter(e=>e.id&&(e.name||e.email)).sort((e,t)=>e.name.localeCompare(t.name,"ru"));return Response.json({users:t})}catch(e){return new Response(JSON.stringify({error:e?.message||"Fetch failed"}),{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/bitrix/users/route",pathname:"/api/bitrix/users",filename:"route",bundlePath:"app/api/bitrix/users/route"},resolvedPagePath:"/Users/user/Desktop/b24-regular-task/app/api/bitrix/users/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=d,x="/api/bitrix/users/route";function g(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},9303:(e,t,r)=>{e.exports=r(517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948],()=>r(9705));module.exports=s})();