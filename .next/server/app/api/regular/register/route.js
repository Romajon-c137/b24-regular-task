"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/regular/register/route";
exports.ids = ["app/api/regular/register/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fregular%2Fregister%2Froute&page=%2Fapi%2Fregular%2Fregister%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fregular%2Fregister%2Froute.ts&appDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fregular%2Fregister%2Froute&page=%2Fapi%2Fregular%2Fregister%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fregular%2Fregister%2Froute.ts&appDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_user_Desktop_b24_regular_task_app_api_regular_register_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/regular/register/route.ts */ \"(rsc)/./app/api/regular/register/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/regular/register/route\",\n        pathname: \"/api/regular/register\",\n        filename: \"route\",\n        bundlePath: \"app/api/regular/register/route\"\n    },\n    resolvedPagePath: \"/Users/user/Desktop/b24-regular-task/app/api/regular/register/route.ts\",\n    nextConfigOutput,\n    userland: _Users_user_Desktop_b24_regular_task_app_api_regular_register_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/regular/register/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyZWd1bGFyJTJGcmVnaXN0ZXIlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnJlZ3VsYXIlMkZyZWdpc3RlciUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnJlZ3VsYXIlMkZyZWdpc3RlciUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnVzZXIlMkZEZXNrdG9wJTJGYjI0LXJlZ3VsYXItdGFzayUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZ1c2VyJTJGRGVza3RvcCUyRmIyNC1yZWd1bGFyLXRhc2smaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3NCO0FBQ25HO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYml0cml4LXJlZ3VsYXItdGFza3MtZnJvbnRlbmQvPzNkOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3VzZXIvRGVza3RvcC9iMjQtcmVndWxhci10YXNrL2FwcC9hcGkvcmVndWxhci9yZWdpc3Rlci9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcmVndWxhci9yZWdpc3Rlci9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3JlZ3VsYXIvcmVnaXN0ZXJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3JlZ3VsYXIvcmVnaXN0ZXIvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvdXNlci9EZXNrdG9wL2IyNC1yZWd1bGFyLXRhc2svYXBwL2FwaS9yZWd1bGFyL3JlZ2lzdGVyL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9yZWd1bGFyL3JlZ2lzdGVyL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fregular%2Fregister%2Froute&page=%2Fapi%2Fregular%2Fregister%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fregular%2Fregister%2Froute.ts&appDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/regular/register/route.ts":
/*!*******************************************!*\
  !*** ./app/api/regular/register/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var _lib_kv__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/kv */ \"(rsc)/./lib/kv.ts\");\n\n// app/api/regular/register/route.ts\n// import redis from \"@/lib/kv\";\nconst runtime = \"nodejs\";\nconst dynamic = \"force-dynamic\";\nfunction nextDailyUTC(timeOfDay, tzOffsetMin, from = new Date()) {\n    const localNow = new Date(from.getTime() + tzOffsetMin * 60000);\n    const [hh, mm] = timeOfDay.split(\":\").map((x)=>parseInt(x, 10));\n    const localRun = new Date(localNow);\n    localRun.setHours(hh, mm, 0, 0);\n    if (localRun <= localNow) localRun.setDate(localRun.getDate() + 1);\n    return localRun.getTime() - tzOffsetMin * 60000;\n}\nfunction daysInMonth(y, m0) {\n    return new Date(y, m0 + 1, 0).getDate();\n}\nfunction clampDay(y, m0, d) {\n    return Math.max(1, Math.min(d, daysInMonth(y, m0)));\n}\nfunction nextMonthlyUTC(dayOfMonth, timeOfDay, tzOffsetMin, from = new Date()) {\n    const localNow = new Date(from.getTime() + tzOffsetMin * 60000);\n    const [hh, mm] = timeOfDay.split(\":\").map((x)=>parseInt(x, 10));\n    const y = localNow.getFullYear();\n    const m0 = localNow.getMonth();\n    let d = clampDay(y, m0, dayOfMonth);\n    let localRun = new Date(localNow);\n    localRun.setDate(d);\n    localRun.setHours(hh, mm, 0, 0);\n    if (localRun <= localNow) {\n        const ny = m0 === 11 ? y + 1 : y;\n        const nm0 = (m0 + 1) % 12;\n        d = clampDay(ny, nm0, dayOfMonth);\n        localRun = new Date(localNow);\n        localRun.setFullYear(ny, nm0, d);\n        localRun.setHours(hh, mm, 0, 0);\n    }\n    return localRun.getTime() - tzOffsetMin * 60000;\n}\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        const task = body?.task;\n        if (!task?.id) return new Response(JSON.stringify({\n            ok: false,\n            error: \"task.id required\"\n        }), {\n            status: 400\n        });\n        if (!task?.repeatRule?.isRecurring) return new Response(JSON.stringify({\n            ok: false,\n            error: \"repeatRule.isRecurring required\"\n        }), {\n            status: 400\n        });\n        // Новое: частота (daily|monthly|minutely для тестов)\n        const mode = String(body?.frequency || body?.mode || \"daily\");\n        const tz = Number(body?.tzOffsetMinutes ?? task?.tzOffsetMinutes ?? new Date().getTimezoneOffset() * -1);\n        // Исполнители: из чекбоксов (массив) или одиночный\n        const assignees = Array.isArray(task?.assignees) && task.assignees.length ? task.assignees : task?.assignee ? [\n            task.assignee\n        ] : [\n            {\n                id: undefined\n            }\n        ];\n        const endsRaw = (task?.repeatRule?.endsAtRaw || \"\").trim();\n        const remainingRuns = /^\\d+$/.test(endsRaw) ? parseInt(endsRaw, 10) : undefined;\n        const timeOfDay = String(task.repeatRule?.timeOfDay || \"05:00\");\n        const dayOfMonth = mode === \"monthly\" ? Number(task.repeatRule?.dayOfMonth || body?.dayOfMonth || 1) : undefined;\n        const webhookBase = body?.webhookBase && String(body.webhookBase).trim() || undefined;\n        const jobsReg = [];\n        for (const a of assignees){\n            const id = assignees.length ? `${task.id}__u${a.id ?? \"na\"}` : String(task.id);\n            const job = {\n                id,\n                kind: mode,\n                timeOfDay: mode !== \"minutely\" ? timeOfDay : undefined,\n                dayOfMonth,\n                stepMinutes: mode === \"minutely\" ? Number(body?.stepMinutes || 1) : undefined,\n                tzOffsetMinutes: Number.isFinite(tz) ? tz : 0,\n                remainingRuns,\n                template: {\n                    title: task.title,\n                    description: task.description || \"\",\n                    responsibleId: a?.id,\n                    creatorId: task.creatorId,\n                    observers: (task.observers || []).map((u)=>u.id),\n                    priority: task.isImportant ? 2 : 1,\n                    requireResult: !!task.requireResult,\n                    deadline: task.dueDate || null,\n                    webhookBase\n                }\n            };\n            const now = new Date();\n            let next = job.kind === \"daily\" ? nextDailyUTC(timeOfDay, job.tzOffsetMinutes, now) : job.kind === \"monthly\" ? nextMonthlyUTC(dayOfMonth ?? 1, timeOfDay, job.tzOffsetMinutes, now) : (()=>{\n                const n = new Date(now);\n                n.setSeconds(0, 0);\n                n.setMinutes(n.getMinutes() + (job.stepMinutes || 1));\n                return +n;\n            })();\n            await _lib_kv__WEBPACK_IMPORTED_MODULE_0__[\"default\"].multi().set(`job:${id}`, JSON.stringify(job)).zadd(\"jobs:next\", {\n                score: next,\n                member: id\n            }).exec();\n            jobsReg.push({\n                id,\n                kind: job.kind,\n                nextRunISO: new Date(next).toISOString()\n            });\n        }\n        return Response.json({\n            ok: true,\n            jobs: jobsReg\n        });\n    } catch (e) {\n        return new Response(JSON.stringify({\n            ok: false,\n            error: e?.message || \"register failed\"\n        }), {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3JlZ3VsYXIvcmVnaXN0ZXIvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUErQztBQUUvQyxvQ0FBb0M7QUFDcEMsZ0NBQWdDO0FBRXpCLE1BQU1DLFVBQVUsU0FBUztBQUN6QixNQUFNQyxVQUFVLGdCQUFnQjtBQTBCdkMsU0FBU0MsYUFBYUMsU0FBaUIsRUFBRUMsV0FBbUIsRUFBRUMsT0FBTyxJQUFJQyxNQUFNO0lBQzdFLE1BQU1DLFdBQVcsSUFBSUQsS0FBS0QsS0FBS0csT0FBTyxLQUFLSixjQUFjO0lBQ3pELE1BQU0sQ0FBQ0ssSUFBSUMsR0FBRyxHQUFHUCxVQUFVUSxLQUFLLENBQUMsS0FBS0MsR0FBRyxDQUFDLENBQUNDLElBQU1DLFNBQVNELEdBQUc7SUFDN0QsTUFBTUUsV0FBVyxJQUFJVCxLQUFLQztJQUFXUSxTQUFTQyxRQUFRLENBQUNQLElBQUlDLElBQUksR0FBRztJQUNsRSxJQUFJSyxZQUFZUixVQUFVUSxTQUFTRSxPQUFPLENBQUNGLFNBQVNHLE9BQU8sS0FBSztJQUNoRSxPQUFPSCxTQUFTUCxPQUFPLEtBQUtKLGNBQWM7QUFDNUM7QUFFQSxTQUFTZSxZQUFZQyxDQUFTLEVBQUVDLEVBQVU7SUFBSSxPQUFPLElBQUlmLEtBQUtjLEdBQUdDLEtBQUssR0FBRyxHQUFHSCxPQUFPO0FBQUk7QUFDdkYsU0FBU0ksU0FBU0YsQ0FBUyxFQUFFQyxFQUFVLEVBQUVFLENBQVM7SUFBSSxPQUFPQyxLQUFLQyxHQUFHLENBQUMsR0FBR0QsS0FBS0UsR0FBRyxDQUFDSCxHQUFHSixZQUFZQyxHQUFHQztBQUFPO0FBQzNHLFNBQVNNLGVBQWVDLFVBQWtCLEVBQUV6QixTQUFpQixFQUFFQyxXQUFtQixFQUFFQyxPQUFPLElBQUlDLE1BQU07SUFDbkcsTUFBTUMsV0FBVyxJQUFJRCxLQUFLRCxLQUFLRyxPQUFPLEtBQUtKLGNBQWM7SUFDekQsTUFBTSxDQUFDSyxJQUFJQyxHQUFHLEdBQUdQLFVBQVVRLEtBQUssQ0FB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O2dCQUFFNEIsWUFBWSxJQUFJNUYsS0FBS2dGLE1BQU1hLFdBQVc7WUFBRztRQUM5RTtRQUVBLE9BQU8zRCxTQUFTSCxJQUFJLENBQUM7WUFBRU0sSUFBSTtZQUFNeUQsTUFBTWpDO1FBQVE7SUFDakQsRUFBRSxPQUFPa0MsR0FBUTtRQUNmLE9BQU8sSUFBSTdELFNBQVNDLEtBQUtDLFNBQVMsQ0FBQztZQUFFQyxJQUFHO1lBQU9DLE9BQU95RCxHQUFHQyxXQUFXO1FBQWtCLElBQUk7WUFBRXpELFFBQU87UUFBSTtJQUN6RztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYml0cml4LXJlZ3VsYXItdGFza3MtZnJvbnRlbmQvLi9hcHAvYXBpL3JlZ3VsYXIvcmVnaXN0ZXIvcm91dGUudHM/MzE3NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVkaXMsIHsga3YgfSBmcm9tIFwiLi4vLi4vLi4vLi4vbGliL2t2XCI7XG5cbi8vIGFwcC9hcGkvcmVndWxhci9yZWdpc3Rlci9yb3V0ZS50c1xuLy8gaW1wb3J0IHJlZGlzIGZyb20gXCJAL2xpYi9rdlwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XG5leHBvcnQgY29uc3QgZHluYW1pYyA9IFwiZm9yY2UtZHluYW1pY1wiO1xuXG50eXBlIEpvYlRlbXBsYXRlID0ge1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgcmVzcG9uc2libGVJZD86IHN0cmluZyB8IG51bWJlcjtcbiAgb2JzZXJ2ZXJzPzogKHN0cmluZyB8IG51bWJlcilbXTtcbiAgY3JlYXRvcklkPzogc3RyaW5nIHwgbnVtYmVyOyAgICAgIC8vIDwtLSDQtNC+0LHQsNCy0YxcbiAgcHJpb3JpdHk/OiAxIHwgMjtcbiAgcmVxdWlyZVJlc3VsdD86IGJvb2xlYW47XG4gIGRlYWRsaW5lPzogc3RyaW5nIHwgbnVsbDsgICAgICAgICAgLy8g0LvQvtC60LDQuy4gXCJZWVlZLU1NLUREVEhIOm1tXCJcbiAgd2ViaG9va0Jhc2U/OiBzdHJpbmc7ICAgICAgICAgICAgICAvLyA8LS0g0JLQkNCW0J3Qnjog0LLQtdCx0YXRg9C6IEJpdHJpeCDQtNC70Y8g0Y3RgtC+0Lkg0LfQsNC00LDRh9C4XG59O1xuXG50eXBlIEpvYiA9IHtcbiAgaWQ6IHN0cmluZztcbiAga2luZDogXCJkYWlseVwiIHwgXCJtb250aGx5XCIgfCBcIm1pbnV0ZWx5XCI7XG4gIHRpbWVPZkRheT86IHN0cmluZzsgICAgICAgICAgICAgICAgLy8gSEg6bW1cbiAgZGF5T2ZNb250aD86IG51bWJlcjsgICAgICAgICAgICAgICAvLyAxLi4zMSAgKNC00LvRjyBtb250aGx5KVxuICBzdGVwTWludXRlcz86IG51bWJlcjsgICAgICAgICAgICAgIC8vINC00LvRjyDRgtC10YHRgtC+0LJcbiAgdHpPZmZzZXRNaW51dGVzOiBudW1iZXI7XG4gIHJlbWFpbmluZ1J1bnM/OiBudW1iZXI7XG4gIHRlbXBsYXRlOiBKb2JUZW1wbGF0ZTtcbiAgXG59O1xuXG5mdW5jdGlvbiBuZXh0RGFpbHlVVEModGltZU9mRGF5OiBzdHJpbmcsIHR6T2Zmc2V0TWluOiBudW1iZXIsIGZyb20gPSBuZXcgRGF0ZSgpKTogbnVtYmVyIHtcbiAgY29uc3QgbG9jYWxOb3cgPSBuZXcgRGF0ZShmcm9tLmdldFRpbWUoKSArIHR6T2Zmc2V0TWluICogNjBfMDAwKTtcbiAgY29uc3QgW2hoLCBtbV0gPSB0aW1lT2ZEYXkuc3BsaXQoXCI6XCIpLm1hcCgoeCkgPT4gcGFyc2VJbnQoeCwgMTApKTtcbiAgY29uc3QgbG9jYWxSdW4gPSBuZXcgRGF0ZShsb2NhbE5vdyk7IGxvY2FsUnVuLnNldEhvdXJzKGhoLCBtbSwgMCwgMCk7XG4gIGlmIChsb2NhbFJ1biA8PSBsb2NhbE5vdykgbG9jYWxSdW4uc2V0RGF0ZShsb2NhbFJ1bi5nZXREYXRlKCkgKyAxKTtcbiAgcmV0dXJuIGxvY2FsUnVuLmdldFRpbWUoKSAtIHR6T2Zmc2V0TWluICogNjBfMDAwO1xufVxuXG5mdW5jdGlvbiBkYXlzSW5Nb250aCh5OiBudW1iZXIsIG0wOiBudW1iZXIpIHsgcmV0dXJuIG5ldyBEYXRlKHksIG0wICsgMSwgMCkuZ2V0RGF0ZSgpOyB9XG5mdW5jdGlvbiBjbGFtcERheSh5OiBudW1iZXIsIG0wOiBudW1iZXIsIGQ6IG51bWJlcikgeyByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5taW4oZCwgZGF5c0luTW9udGgoeSwgbTApKSk7IH1cbmZ1bmN0aW9uIG5leHRNb250aGx5VVRDKGRheU9mTW9udGg6IG51bWJlciwgdGltZU9mRGF5OiBzdHJpbmcsIHR6T2Zmc2V0TWluOiBudW1iZXIsIGZyb20gPSBuZXcgRGF0ZSgpKTogbnVtYmVyIHtcbiAgY29uc3QgbG9jYWxOb3cgPSBuZXcgRGF0ZShmcm9tLmdldFRpbWUoKSArIHR6T2Zmc2V0TWluICogNjBfMDAwKTtcbiAgY29uc3QgW2hoLCBtbV0gPSB0aW1lT2ZEYXkuc3BsaXQoXCI6XCIpLm1hcCgoeCkgPT4gcGFyc2VJbnQoeCwgMTApKTtcbiAgY29uc3QgeSA9IGxvY2FsTm93LmdldEZ1bGxZZWFyKCk7XG4gIGNvbnN0IG0wID0gbG9jYWxOb3cuZ2V0TW9udGgoKTtcbiAgbGV0IGQgPSBjbGFtcERheSh5LCBtMCwgZGF5T2ZNb250aCk7XG4gIGxldCBsb2NhbFJ1biA9IG5ldyBEYXRlKGxvY2FsTm93KTsgbG9jYWxSdW4uc2V0RGF0ZShkKTsgbG9jYWxSdW4uc2V0SG91cnMoaGgsIG1tLCAwLCAwKTtcbiAgaWYgKGxvY2FsUnVuIDw9IGxvY2FsTm93KSB7XG4gICAgY29uc3QgbnkgPSBtMCA9PT0gMTEgPyB5ICsgMSA6IHk7XG4gICAgY29uc3Qgbm0wID0gKG0wICsgMSkgJSAxMjtcbiAgICBkID0gY2xhbXBEYXkobnksIG5tMCwgZGF5T2ZNb250aCk7XG4gICAgbG9jYWxSdW4gPSBuZXcgRGF0ZShsb2NhbE5vdyk7IGxvY2FsUnVuLnNldEZ1bGxZZWFyKG55LCBubTAsIGQpOyBsb2NhbFJ1bi5zZXRIb3VycyhoaCwgbW0sIDAsIDApO1xuICB9XG4gIHJldHVybiBsb2NhbFJ1bi5nZXRUaW1lKCkgLSB0ek9mZnNldE1pbiAqIDYwXzAwMDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgY29uc3QgdGFzayA9IGJvZHk/LnRhc2s7XG4gICAgaWYgKCF0YXNrPy5pZCkgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG9rOmZhbHNlLCBlcnJvcjpcInRhc2suaWQgcmVxdWlyZWRcIiB9KSwgeyBzdGF0dXM6NDAwIH0pO1xuICAgIGlmICghdGFzaz8ucmVwZWF0UnVsZT8uaXNSZWN1cnJpbmcpIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazpmYWxzZSwgZXJyb3I6XCJyZXBlYXRSdWxlLmlzUmVjdXJyaW5nIHJlcXVpcmVkXCIgfSksIHsgc3RhdHVzOjQwMCB9KTtcblxuICAgIC8vINCd0L7QstC+0LU6INGH0LDRgdGC0L7RgtCwIChkYWlseXxtb250aGx5fG1pbnV0ZWx5INC00LvRjyDRgtC10YHRgtC+0LIpXG4gICAgY29uc3QgbW9kZSA9IChTdHJpbmcoYm9keT8uZnJlcXVlbmN5IHx8IGJvZHk/Lm1vZGUgfHwgXCJkYWlseVwiKSBhcyBcImRhaWx5XCIgfCBcIm1vbnRobHlcIiB8IFwibWludXRlbHlcIik7XG4gICAgY29uc3QgdHogPSBOdW1iZXIoYm9keT8udHpPZmZzZXRNaW51dGVzID8/IHRhc2s/LnR6T2Zmc2V0TWludXRlcyA/PyAobmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpICogLTEpKTtcblxuICAgIC8vINCY0YHQv9C+0LvQvdC40YLQtdC70Lg6INC40Lcg0YfQtdC60LHQvtC60YHQvtCyICjQvNCw0YHRgdC40LIpINC40LvQuCDQvtC00LjQvdC+0YfQvdGL0LlcbiAgICBjb25zdCBhc3NpZ25lZXM6IEFycmF5PHsgaWQ/OiBzdHJpbmcgfCBudW1iZXIgfT4gPVxuICAgICAgQXJyYXkuaXNBcnJheSh0YXNrPy5hc3NpZ25lZXMpICYmIHRhc2suYXNzaWduZWVzLmxlbmd0aCA/IHRhc2suYXNzaWduZWVzXG4gICAgICA6IHRhc2s/LmFzc2lnbmVlID8gW3Rhc2suYXNzaWduZWVdXG4gICAgICA6IFt7IGlkOiB1bmRlZmluZWQgfV07XG5cbiAgICBjb25zdCBlbmRzUmF3ID0gKHRhc2s/LnJlcGVhdFJ1bGU/LmVuZHNBdFJhdyB8fCBcIlwiKS50cmltKCk7XG4gICAgY29uc3QgcmVtYWluaW5nUnVucyA9IC9eXFxkKyQvLnRlc3QoZW5kc1JhdykgPyBwYXJzZUludChlbmRzUmF3LCAxMCkgOiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCB0aW1lT2ZEYXk6IHN0cmluZyA9IFN0cmluZyh0YXNrLnJlcGVhdFJ1bGU/LnRpbWVPZkRheSB8fCBcIjA1OjAwXCIpO1xuICAgIGNvbnN0IGRheU9mTW9udGg6IG51bWJlciB8IHVuZGVmaW5lZCA9XG4gICAgICBtb2RlID09PSBcIm1vbnRobHlcIiA/IE51bWJlcih0YXNrLnJlcGVhdFJ1bGU/LmRheU9mTW9udGggfHwgYm9keT8uZGF5T2ZNb250aCB8fCAxKSA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IHdlYmhvb2tCYXNlOiBzdHJpbmcgfCB1bmRlZmluZWQgPVxuICAgICAgKGJvZHk/LndlYmhvb2tCYXNlICYmIFN0cmluZyhib2R5LndlYmhvb2tCYXNlKS50cmltKCkpIHx8IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IGpvYnNSZWcgPSBbXTtcblxuICAgIGZvciAoY29uc3QgYSBvZiBhc3NpZ25lZXMpIHtcbiAgICAgIGNvbnN0IGlkID0gYXNzaWduZWVzLmxlbmd0aCA/IGAke3Rhc2suaWR9X191JHthLmlkID8/IFwibmFcIn1gIDogU3RyaW5nKHRhc2suaWQpO1xuXG4gICAgICBjb25zdCBqb2I6IEpvYiA9IHtcbiAgICAgICAgaWQsXG4gICAgICAgIGtpbmQ6IG1vZGUsXG4gICAgICAgIHRpbWVPZkRheTogbW9kZSAhPT0gXCJtaW51dGVseVwiID8gdGltZU9mRGF5IDogdW5kZWZpbmVkLFxuICAgICAgICBkYXlPZk1vbnRoLFxuICAgICAgICBzdGVwTWludXRlczogbW9kZSA9PT0gXCJtaW51dGVseVwiID8gTnVtYmVyKGJvZHk/LnN0ZXBNaW51dGVzIHx8IDEpIDogdW5kZWZpbmVkLFxuICAgICAgICB0ek9mZnNldE1pbnV0ZXM6IE51bWJlci5pc0Zpbml0ZSh0eikgPyB0eiA6IDAsXG4gICAgICAgIHJlbWFpbmluZ1J1bnMsXG4gICAgICAgIHRlbXBsYXRlOiB7XG4gICAgICAgICAgdGl0bGU6IHRhc2sudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHRhc2suZGVzY3JpcHRpb24gfHwgXCJcIixcbiAgICAgICAgICByZXNwb25zaWJsZUlkOiBhPy5pZCxcbiAgICAgICAgICBjcmVhdG9ySWQ6IHRhc2suY3JlYXRvcklkLCAgLy8gPC0tINGB0Y7QtNCwXG4gICAgICAgICAgb2JzZXJ2ZXJzOiAodGFzay5vYnNlcnZlcnMgfHwgW10pLm1hcCgodTogYW55KSA9PiB1LmlkKSxcbiAgICAgICAgICBwcmlvcml0eTogdGFzay5pc0ltcG9ydGFudCA/IDIgOiAxLFxuICAgICAgICAgIHJlcXVpcmVSZXN1bHQ6ICEhdGFzay5yZXF1aXJlUmVzdWx0LFxuICAgICAgICAgIGRlYWRsaW5lOiB0YXNrLmR1ZURhdGUgfHwgbnVsbCxcbiAgICAgICAgICB3ZWJob29rQmFzZSwgLy8gPC0g0YHQvtGF0YDQsNC90Y/QtdC8INCy0LXQsdGF0YPQuiDQstC80LXRgdGC0LUg0YEg0YjQsNCx0LvQvtC90L7QvFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGxldCBuZXh0ID1cbiAgICAgICAgam9iLmtpbmQgPT09IFwiZGFpbHlcIlxuICAgICAgICAgID8gbmV4dERhaWx5VVRDKHRpbWVPZkRheSwgam9iLnR6T2Zmc2V0TWludXRlcywgbm93KVxuICAgICAgICAgIDogam9iLmtpbmQgPT09IFwibW9udGhseVwiXG4gICAgICAgICAgPyBuZXh0TW9udGhseVVUQyhkYXlPZk1vbnRoID8/IDEsIHRpbWVPZkRheSwgam9iLnR6T2Zmc2V0TWludXRlcywgbm93KVxuICAgICAgICAgIDogKCgpID0+IHsgY29uc3QgbiA9IG5ldyBEYXRlKG5vdyk7IG4uc2V0U2Vjb25kcygwLDApOyBuLnNldE1pbnV0ZXMobi5nZXRNaW51dGVzKCkgKyAoam9iLnN0ZXBNaW51dGVzIHx8IDEpKTsgcmV0dXJuICtuOyB9KSgpO1xuXG4gICAgICBhd2FpdCAocmVkaXMgYXMgYW55KS5tdWx0aSgpXG4gICAgICAgIC5zZXQoYGpvYjoke2lkfWAsIEpTT04uc3RyaW5naWZ5KGpvYikpXG4gICAgICAgIC56YWRkKFwiam9iczpuZXh0XCIsIHsgc2NvcmU6IG5leHQsIG1lbWJlcjogaWQgfSlcbiAgICAgICAgLmV4ZWMoKTtcblxuICAgICAgam9ic1JlZy5wdXNoKHsgaWQsIGtpbmQ6IGpvYi5raW5kLCBuZXh0UnVuSVNPOiBuZXcgRGF0ZShuZXh0KS50b0lTT1N0cmluZygpIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBSZXNwb25zZS5qc29uKHsgb2s6IHRydWUsIGpvYnM6IGpvYnNSZWcgfSk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBvazpmYWxzZSwgZXJyb3I6IGU/Lm1lc3NhZ2UgfHwgXCJyZWdpc3RlciBmYWlsZWRcIiB9KSwgeyBzdGF0dXM6NTAwIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsicmVkaXMiLCJydW50aW1lIiwiZHluYW1pYyIsIm5leHREYWlseVVUQyIsInRpbWVPZkRheSIsInR6T2Zmc2V0TWluIiwiZnJvbSIsIkRhdGUiLCJsb2NhbE5vdyIsImdldFRpbWUiLCJoaCIsIm1tIiwic3BsaXQiLCJtYXAiLCJ4IiwicGFyc2VJbnQiLCJsb2NhbFJ1biIsInNldEhvdXJzIiwic2V0RGF0ZSIsImdldERhdGUiLCJkYXlzSW5Nb250aCIsInkiLCJtMCIsImNsYW1wRGF5IiwiZCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJuZXh0TW9udGhseVVUQyIsImRheU9mTW9udGgiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwibnkiLCJubTAiLCJzZXRGdWxsWWVhciIsIlBPU1QiLCJyZXEiLCJib2R5IiwianNvbiIsInRhc2siLCJpZCIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwiZXJyb3IiLCJzdGF0dXMiLCJyZXBlYXRSdWxlIiwiaXNSZWN1cnJpbmciLCJtb2RlIiwiU3RyaW5nIiwiZnJlcXVlbmN5IiwidHoiLCJOdW1iZXIiLCJ0ek9mZnNldE1pbnV0ZXMiLCJnZXRUaW1lem9uZU9mZnNldCIsImFzc2lnbmVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImFzc2lnbmVlIiwidW5kZWZpbmVkIiwiZW5kc1JhdyIsImVuZHNBdFJhdyIsInRyaW0iLCJyZW1haW5pbmdSdW5zIiwidGVzdCIsIndlYmhvb2tCYXNlIiwiam9ic1JlZyIsImEiLCJqb2IiLCJraW5kIiwic3RlcE1pbnV0ZXMiLCJpc0Zpbml0ZSIsInRlbXBsYXRlIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInJlc3BvbnNpYmxlSWQiLCJjcmVhdG9ySWQiLCJvYnNlcnZlcnMiLCJ1IiwicHJpb3JpdHkiLCJpc0ltcG9ydGFudCIsInJlcXVpcmVSZXN1bHQiLCJkZWFkbGluZSIsImR1ZURhdGUiLCJub3ciLCJuZXh0IiwibiIsInNldFNlY29uZHMiLCJzZXRNaW51dGVzIiwiZ2V0TWludXRlcyIsIm11bHRpIiwic2V0IiwiemFkZCIsInNjb3JlIiwibWVtYmVyIiwiZXhlYyIsInB1c2giLCJuZXh0UnVuSVNPIiwidG9JU09TdHJpbmciLCJqb2JzIiwiZSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/regular/register/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/kv.ts":
/*!*******************!*\
  !*** ./lib/kv.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   kv: () => (/* binding */ kv)\n/* harmony export */ });\n/* harmony import */ var _upstash_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @upstash/redis */ \"(rsc)/./node_modules/@upstash/redis/nodejs.mjs\");\n// lib/kv.ts\n\n/**\n * Ленивая инициализация клиента.\n * Нельзя бросать ошибку на уровне импорта — Next подгружает файлы на build.\n */ let _client = null;\nfunction getClient() {\n    if (_client) return _client;\n    const url = process.env.UPSTASH_REDIS_REST_URL;\n    const token = process.env.UPSTASH_REDIS_REST_TOKEN;\n    if (!url || !token) {\n        // Бросаем только при РЕАЛЬНОМ обращении к Redis, а не на импорте\n        throw new Error(\"UPSTASH_REDIS_REST_URL / UPSTASH_REDIS_REST_TOKEN are not set\");\n    }\n    _client = new _upstash_redis__WEBPACK_IMPORTED_MODULE_0__.Redis({\n        url,\n        token\n    });\n    return _client;\n}\n// Экспорт \"сырого\" клиента как прокси, чтобы не инициализировать на импорт\nconst redis = new Proxy({}, {\n    get (_t, prop) {\n        // @ts-expect-error — проксируем любые методы реального клиента\n        return getClient()[prop];\n    }\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (redis);\nconst kv = {\n    // JSON helpers\n    async getJSON (key) {\n        const raw = await getClient().get(key);\n        return raw ? JSON.parse(raw) : null;\n    },\n    async setJSON (key, value) {\n        return getClient().set(key, JSON.stringify(value));\n    },\n    // sorted set helpers\n    zadd (key, score, member) {\n        return getClient().zadd(key, {\n            score,\n            member\n        });\n    },\n    zrem (key, member) {\n        return getClient().zrem(key, member);\n    },\n    // у @upstash/redis нет zrangebyscore → используем zrange с byScore: true\n    async zrangeByScore (key, min, max) {\n        // типы у версии разные — берём any для совместимости\n        const res = await getClient().zrange(key, min, max, {\n            byScore: true\n        });\n        return res;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIva3YudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsWUFBWTtBQUMyQjtBQUV2Qzs7O0NBR0MsR0FDRCxJQUFJQyxVQUF3QjtBQUU1QixTQUFTQztJQUNQLElBQUlELFNBQVMsT0FBT0E7SUFFcEIsTUFBTUUsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxzQkFBc0I7SUFDOUMsTUFBTUMsUUFBUUgsUUFBUUMsR0FBRyxDQUFDRyx3QkFBd0I7SUFFbEQsSUFBSSxDQUFDTCxPQUFPLENBQUNJLE9BQU87UUFDbEIsaUVBQWlFO1FBQ2pFLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBUixVQUFVLElBQUlELGlEQUFLQSxDQUFDO1FBQUVHO1FBQUtJO0lBQU07SUFDakMsT0FBT047QUFDVDtBQUVBLDJFQUEyRTtBQUMzRSxNQUFNUyxRQUFRLElBQUlDLE1BQ2hCLENBQUMsR0FDRDtJQUNFQyxLQUFJQyxFQUFFLEVBQUVDLElBQUk7UUFDViwrREFBK0Q7UUFDL0QsT0FBT1osV0FBVyxDQUFDWSxLQUFLO0lBQzFCO0FBQ0Y7QUFHRixpRUFBZUosS0FBS0EsRUFBQztBQUVkLE1BQU1LLEtBQUs7SUFDaEIsZUFBZTtJQUNmLE1BQU1DLFNBQVdDLEdBQVc7UUFDMUIsTUFBTUMsTUFBTSxNQUFNaEIsWUFBWVUsR0FBRyxDQUFTSztRQUMxQyxPQUFPQyxNQUFPQyxLQUFLQyxLQUFLLENBQUNGLE9BQWE7SUFDeEM7SUFDQSxNQUFNRyxTQUFRSixHQUFXLEVBQUVLLEtBQWM7UUFDdkMsT0FBT3BCLFlBQVlxQixHQUFHLENBQUNOLEtBQUtFLEtBQUtLLFNBQVMsQ0FBQ0Y7SUFDN0M7SUFFQSxxQkFBcUI7SUFDckJHLE1BQUtSLEdBQVcsRUFBRVMsS0FBYSxFQUFFQyxNQUFjO1FBQzdDLE9BQU96QixZQUFZdUIsSUFBSSxDQUFDUixLQUFLO1lBQUVTO1lBQU9DO1FBQU87SUFDL0M7SUFDQUMsTUFBS1gsR0FBVyxFQUFFVSxNQUFjO1FBQzlCLE9BQU96QixZQUFZMEIsSUFBSSxDQUFDWCxLQUFLVTtJQUMvQjtJQUNBLHlFQUF5RTtJQUN6RSxNQUFNRSxlQUFjWixHQUFXLEVBQUVhLEdBQVcsRUFBRUMsR0FBVztRQUN2RCxxREFBcUQ7UUFDckQsTUFBTUMsTUFBTSxNQUFNLFlBQXFCQyxNQUFNLENBQUNoQixLQUFLYSxLQUFLQyxLQUFLO1lBQUVHLFNBQVM7UUFBSztRQUM3RSxPQUFPRjtJQUNUO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JpdHJpeC1yZWd1bGFyLXRhc2tzLWZyb250ZW5kLy4vbGliL2t2LnRzP2VhNGYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL2t2LnRzXG5pbXBvcnQgeyBSZWRpcyB9IGZyb20gXCJAdXBzdGFzaC9yZWRpc1wiO1xuXG4vKipcbiAqINCb0LXQvdC40LLQsNGPINC40L3QuNGG0LjQsNC70LjQt9Cw0YbQuNGPINC60LvQuNC10L3RgtCwLlxuICog0J3QtdC70YzQt9GPINCx0YDQvtGB0LDRgtGMINC+0YjQuNCx0LrRgyDQvdCwINGD0YDQvtCy0L3QtSDQuNC80L/QvtGA0YLQsCDigJQgTmV4dCDQv9C+0LTQs9GA0YPQttCw0LXRgiDRhNCw0LnQu9GLINC90LAgYnVpbGQuXG4gKi9cbmxldCBfY2xpZW50OiBSZWRpcyB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBnZXRDbGllbnQoKTogUmVkaXMge1xuICBpZiAoX2NsaWVudCkgcmV0dXJuIF9jbGllbnQ7XG5cbiAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1VSTDtcbiAgY29uc3QgdG9rZW4gPSBwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVE9LRU47XG5cbiAgaWYgKCF1cmwgfHwgIXRva2VuKSB7XG4gICAgLy8g0JHRgNC+0YHQsNC10Lwg0YLQvtC70YzQutC+INC/0YDQuCDQoNCV0JDQm9Cs0J3QntCcINC+0LHRgNCw0YnQtdC90LjQuCDQuiBSZWRpcywg0LAg0L3QtSDQvdCwINC40LzQv9C+0YDRgtC1XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVVBTVEFTSF9SRURJU19SRVNUX1VSTCAvIFVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTiBhcmUgbm90IHNldFwiKTtcbiAgfVxuXG4gIF9jbGllbnQgPSBuZXcgUmVkaXMoeyB1cmwsIHRva2VuIH0pO1xuICByZXR1cm4gX2NsaWVudDtcbn1cblxuLy8g0K3QutGB0L/QvtGA0YIgXCLRgdGL0YDQvtCz0L5cIiDQutC70LjQtdC90YLQsCDQutCw0Log0L/RgNC+0LrRgdC4LCDRh9GC0L7QsdGLINC90LUg0LjQvdC40YbQuNCw0LvQuNC30LjRgNC+0LLQsNGC0Ywg0L3QsCDQuNC80L/QvtGA0YJcbmNvbnN0IHJlZGlzID0gbmV3IFByb3h5KFxuICB7fSxcbiAge1xuICAgIGdldChfdCwgcHJvcCkge1xuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciDigJQg0L/RgNC+0LrRgdC40YDRg9C10Lwg0LvRjtCx0YvQtSDQvNC10YLQvtC00Ysg0YDQtdCw0LvRjNC90L7Qs9C+INC60LvQuNC10L3RgtCwXG4gICAgICByZXR1cm4gZ2V0Q2xpZW50KClbcHJvcF07XG4gICAgfSxcbiAgfVxuKSBhcyB1bmtub3duIGFzIFJlZGlzO1xuXG5leHBvcnQgZGVmYXVsdCByZWRpcztcblxuZXhwb3J0IGNvbnN0IGt2ID0ge1xuICAvLyBKU09OIGhlbHBlcnNcbiAgYXN5bmMgZ2V0SlNPTjxUPihrZXk6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHtcbiAgICBjb25zdCByYXcgPSBhd2FpdCBnZXRDbGllbnQoKS5nZXQ8c3RyaW5nPihrZXkpO1xuICAgIHJldHVybiByYXcgPyAoSlNPTi5wYXJzZShyYXcpIGFzIFQpIDogbnVsbDtcbiAgfSxcbiAgYXN5bmMgc2V0SlNPTihrZXk6IHN0cmluZywgdmFsdWU6IHVua25vd24pIHtcbiAgICByZXR1cm4gZ2V0Q2xpZW50KCkuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgfSxcblxuICAvLyBzb3J0ZWQgc2V0IGhlbHBlcnNcbiAgemFkZChrZXk6IHN0cmluZywgc2NvcmU6IG51bWJlciwgbWVtYmVyOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gZ2V0Q2xpZW50KCkuemFkZChrZXksIHsgc2NvcmUsIG1lbWJlciB9KTtcbiAgfSxcbiAgenJlbShrZXk6IHN0cmluZywgbWVtYmVyOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gZ2V0Q2xpZW50KCkuenJlbShrZXksIG1lbWJlcik7XG4gIH0sXG4gIC8vINGDIEB1cHN0YXNoL3JlZGlzINC90LXRgiB6cmFuZ2VieXNjb3JlIOKGkiDQuNGB0L/QvtC70YzQt9GD0LXQvCB6cmFuZ2Ug0YEgYnlTY29yZTogdHJ1ZVxuICBhc3luYyB6cmFuZ2VCeVNjb3JlKGtleTogc3RyaW5nLCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgLy8g0YLQuNC/0Ysg0YMg0LLQtdGA0YHQuNC4INGA0LDQt9C90YvQtSDigJQg0LHQtdGA0ZHQvCBhbnkg0LTQu9GPINGB0L7QstC80LXRgdGC0LjQvNC+0YHRgtC4XG4gICAgY29uc3QgcmVzID0gYXdhaXQgKGdldENsaWVudCgpIGFzIGFueSkuenJhbmdlKGtleSwgbWluLCBtYXgsIHsgYnlTY29yZTogdHJ1ZSB9KTtcbiAgICByZXR1cm4gcmVzIGFzIHN0cmluZ1tdO1xuICB9LFxufTtcbiJdLCJuYW1lcyI6WyJSZWRpcyIsIl9jbGllbnQiLCJnZXRDbGllbnQiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiVVBTVEFTSF9SRURJU19SRVNUX1VSTCIsInRva2VuIiwiVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOIiwiRXJyb3IiLCJyZWRpcyIsIlByb3h5IiwiZ2V0IiwiX3QiLCJwcm9wIiwia3YiLCJnZXRKU09OIiwia2V5IiwicmF3IiwiSlNPTiIsInBhcnNlIiwic2V0SlNPTiIsInZhbHVlIiwic2V0Iiwic3RyaW5naWZ5IiwiemFkZCIsInNjb3JlIiwibWVtYmVyIiwienJlbSIsInpyYW5nZUJ5U2NvcmUiLCJtaW4iLCJtYXgiLCJyZXMiLCJ6cmFuZ2UiLCJieVNjb3JlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/kv.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@upstash","vendor-chunks/uncrypto"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fregular%2Fregister%2Froute&page=%2Fapi%2Fregular%2Fregister%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fregular%2Fregister%2Froute.ts&appDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fuser%2FDesktop%2Fb24-regular-task&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();