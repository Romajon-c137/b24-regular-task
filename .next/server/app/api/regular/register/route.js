"use strict";(()=>{var e={};e.id=918,e.ids=[918],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},5479:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{POST:()=>p,dynamic:()=>d,runtime:()=>o});var i=r(9303),n=r(8716),a=r(670),u=r(4332);let o="nodejs",d="force-dynamic";async function p(e){try{let t=await e.json(),r=t?.task;if(!r?.id)return new Response(JSON.stringify({ok:!1,error:"task.id required"}),{status:400});if(!r?.repeatRule?.isRecurring)return new Response(JSON.stringify({ok:!1,error:"repeatRule.isRecurring required"}),{status:400});let s=String(t?.mode||"daily"),i=Number(t?.tzOffsetMinutes??r?.tzOffsetMinutes??-1*new Date().getTimezoneOffset()),n=Array.isArray(r?.assignees)&&r.assignees.length?r.assignees:r?.assignee?[r.assignee]:[{id:void 0}],a=(r?.repeatRule?.endsAtRaw||"").trim(),o=/^\d+$/.test(a)?parseInt(a,10):void 0,d=[];for(let e of n){let a=n.length?`${r.id}__u${e.id??"na"}`:String(r.id),p={id:a,kind:s,timeOfDay:"daily"===s?String(r.repeatRule.timeOfDay||"05:00"):void 0,stepMinutes:"minutely"===s?Number(t?.stepMinutes||1):void 0,tzOffsetMinutes:Number.isFinite(i)?i:0,remainingRuns:o,template:{title:r.title,description:r.description||"",responsibleId:e?.id,observers:(r.observers||[]).map(e=>e.id),priority:r.isImportant?2:1,requireResult:!!r.requireResult,deadline:r.dueDate||null}},l=new Date,g="daily"===p.kind?function(e,t,r=new Date){let s=new Date(r.getTime()+6e4*t),[i,n]=e.split(":").map(e=>parseInt(e,10)),a=new Date(s);return a.setHours(i,n,0,0),a<=s&&a.setDate(a.getDate()+1),a.getTime()-6e4*t}(p.timeOfDay||"05:00",p.tzOffsetMinutes,l):function(e=1,t=new Date){let r=new Date(t);return r.setSeconds(0,0),r.setMinutes(r.getMinutes()+e),r.getTime()}(p.stepMinutes||1,l);await u.Z.multi().set(`job:${a}`,JSON.stringify(p)).zadd("jobs:next",{score:g,member:a}).exec(),d.push({id:a,nextRunISO:new Date(g).toISOString()})}return Response.json({ok:!0,jobs:d})}catch(e){return new Response(JSON.stringify({ok:!1,error:e?.message||"register failed"}),{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/regular/register/route",pathname:"/api/regular/register",filename:"route",bundlePath:"app/api/regular/register/route"},resolvedPagePath:"/Users/user/Desktop/b24-regular-task/app/api/regular/register/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:m}=l,S="/api/regular/register/route";function f(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},4332:(e,t,r)=>{r.d(t,{Z:()=>a,kv:()=>u});var s=r(6859);let i=null;function n(){if(i)return i;let e=process.env.UPSTASH_REDIS_REST_URL,t=process.env.UPSTASH_REDIS_REST_TOKEN;if(!e||!t)throw Error("UPSTASH_REDIS_REST_URL / UPSTASH_REDIS_REST_TOKEN are not set");return i=new s.s({url:e,token:t})}let a=new Proxy({},{get:(e,t)=>n()[t]}),u={async getJSON(e){let t=await n().get(e);return t?JSON.parse(t):null},setJSON:async(e,t)=>n().set(e,JSON.stringify(t)),zadd:(e,t,r)=>n().zadd(e,{score:t,member:r}),zrem:(e,t)=>n().zrem(e,t),zrangeByScore:async(e,t,r)=>await n().zrange(e,t,r,{byScore:!0})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,113],()=>r(5479));module.exports=s})();