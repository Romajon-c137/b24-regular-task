(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7849:function(e,s,l){Promise.resolve().then(l.bind(l,4802))},4802:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return b}});var t=l(7437),i=l(2265);function a(e){let{open:s,onClose:l,children:a,title:n,size:d="md"}=e;return((0,i.useEffect)(()=>{let e=e=>"Escape"===e.key&&l();return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l]),s)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:l}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full ".concat({sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"}[d]," mx-4"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:n}),(0,t.jsx)("button",{onClick:l,className:"px-2 py-1 rounded-md hover:bg-gray-100",children:"✕"})]}),(0,t.jsx)("div",{className:"p-6",children:a})]})]}):null}var n=l(9343),d=l(537),r=l(1885),c=l(9099),o=l(9291),u=l(2290);let x=(0,c.Ue)()((0,o.tJ)((e,s)=>({tasks:[],upsert:l=>{var t,i,a,n,d,r,c,o,x,m,p,h,v,g,j,y;let f=l.id||(0,u.x0)(),b=new Date().toISOString(),N=s().tasks.find(e=>e.id===f),k={id:f,title:l.title||(null==N?void 0:N.title)||"Без названия",description:null!==(t=l.description)&&void 0!==t?t:null==N?void 0:N.description,assignee:l.assignee||(null==N?void 0:N.assignee)||{id:"0",email:"",name:"Не выбран"},creator:l.creator||(null==N?void 0:N.creator)||{id:"me",email:"",name:"Я"},coAssignees:null!==(a=null!==(i=l.coAssignees)&&void 0!==i?i:null==N?void 0:N.coAssignees)&&void 0!==a?a:[],observers:null!==(d=null!==(n=l.observers)&&void 0!==n?n:null==N?void 0:N.observers)&&void 0!==d?d:[],isImportant:null!==(c=null!==(r=l.isImportant)&&void 0!==r?r:null==N?void 0:N.isImportant)&&void 0!==c&&c,dueDate:null!==(o=l.dueDate)&&void 0!==o?o:null==N?void 0:N.dueDate,requireResult:null!==(m=null!==(x=l.requireResult)&&void 0!==x?x:null==N?void 0:N.requireResult)&&void 0!==m&&m,checklist:null!==(h=null!==(p=l.checklist)&&void 0!==p?p:null==N?void 0:N.checklist)&&void 0!==h?h:[],attachments:null!==(g=null!==(v=l.attachments)&&void 0!==v?v:null==N?void 0:N.attachments)&&void 0!==g?g:[],createdAt:(null==N?void 0:N.createdAt)||b,repeatRule:null!==(y=null!==(j=l.repeatRule)&&void 0!==j?j:null==N?void 0:N.repeatRule)&&void 0!==y?y:{isRecurring:!1}};return e(e=>({tasks:N?e.tasks.map(e=>e.id===f?k:e):[k,...e.tasks]})),f},remove:s=>e(e=>({tasks:e.tasks.filter(e=>e.id!==s)})),getById:e=>s().tasks.find(s=>s.id===e)}),{name:"tasks_v1",storage:(0,o.FL)(()=>window.localStorage),skipHydration:!1})),m=d.Ry({id:d.Z_().optional(),title:d.Z_().min(1,"Введите название задачи"),description:d.Z_().optional(),assignee:d.Ry({id:d.Z_(),email:d.Z_().optional(),name:d.Z_().optional()}),assignees:d.IX(d.Ry({id:d.Z_(),email:d.Z_().optional(),name:d.Z_().optional()})).optional(),creator:d.Ry({id:d.Z_(),email:d.Z_().optional(),name:d.Z_().optional()}),coAssignees:d.IX(d.Ry({id:d.Z_(),email:d.Z_().optional(),name:d.Z_().optional()})).optional(),observers:d.IX(d.Ry({id:d.Z_(),email:d.Z_().optional(),name:d.Z_().optional()})).optional(),isImportant:d.O7().optional(),dueDate:d.Z_().optional(),requireResult:d.O7().optional(),repeatRule:d.Ry({isRecurring:d.O7(),timeOfDay:d.Z_().optional(),startsAt:d.Z_().optional(),endsAtRaw:d.Z_().optional()}),checklist:d.IX(d.Ry({id:d.Z_(),text:d.Z_(),done:d.O7()})).optional(),attachments:d.IX(d.Ry({id:d.Z_(),name:d.Z_()})).optional()});async function p(){let e=await fetch("/api/bitrix/users",{cache:"no-store"}),s=await e.json();if(!e.ok)throw Error((null==s?void 0:s.error)||"Не удалось получить пользователей");return s.users}function h(e){let{initial:s,onSaved:l,onCancel:a}=e;x(e=>e.upsert);let d=x(e=>e.getById),[c,o]=(0,i.useState)([]),[u,h]=(0,i.useState)(!0),[v,g]=(0,i.useState)(null),j=(0,i.useMemo)(()=>({id:"0",email:"",name:"Не выбран"}),[]),y=(0,i.useMemo)(()=>({id:"me",email:"",name:"Я"}),[]),f=(0,n.cI)({resolver:(0,r.F)(m),defaultValues:{id:null==s?void 0:s.id,title:(null==s?void 0:s.title)||"",description:(null==s?void 0:s.description)||"",assignee:(null==s?void 0:s.assignee)||j,assignees:(null==s?void 0:s.assignees)||[],creator:(null==s?void 0:s.creator)||y,coAssignees:(null==s?void 0:s.coAssignees)||[],observers:(null==s?void 0:s.observers)||[],isImportant:(null==s?void 0:s.isImportant)||!1,dueDate:(null==s?void 0:s.dueDate)||"",requireResult:(null==s?void 0:s.requireResult)||!1,repeatRule:(null==s?void 0:s.repeatRule)||{isRecurring:!1,timeOfDay:"05:00"},checklist:(null==s?void 0:s.checklist)||[],attachments:(null==s?void 0:s.attachments)||[]}}),{fields:b,append:N,remove:k,update:w}=(0,n.Dq)({control:f.control,name:"checklist"});(0,i.useEffect)(()=>{let e=!0;return h(!0),p().then(s=>{if(!e)return;o(s),g(null);let l=s[0];if(l){let e=f.getValues("assignee");(null==e?void 0:e.id)&&"0"!==e.id||f.setValue("assignee",l);let s=f.getValues("creator");(null==s?void 0:s.id)&&"me"!==s.id||f.setValue("creator",l)}}).catch(s=>e&&g(String((null==s?void 0:s.message)||s))).finally(()=>e&&h(!1)),()=>void(e=!1)},[]);let[R,_]=(0,i.useState)(null),[D,O]=(0,i.useState)(!1);async function C(e){_(null),O(!0);let s=!!e.id,t=x.getState().upsert(e),i=d(t);try{if(s)_("Сохранено локально (без создания новой задачи)");else{let e=await fetch("/api/bitrix/tasks/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:i,tzOffsetMinutes:-1*new Date().getTimezoneOffset()})}),s=await e.json();(null==s?void 0:s.ok)?_("Создано в Bitrix"):_("Bitrix ошибка: ".concat((null==s?void 0:s.error)||(null==s?void 0:s.status)))}}catch(e){_("Bitrix исключение: ".concat(String((null==e?void 0:e.message)||e)))}try{var a;if(null===(a=e.repeatRule)||void 0===a?void 0:a.isRecurring){let e=await fetch("/api/regular/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:i,tzOffsetMinutes:-1*new Date().getTimezoneOffset()})}),s=await e.json();_(e=>(e?e+" • ":"")+((null==s?void 0:s.ok)?"Расписание зарегистрировано":"Расписание: ошибка ".concat((null==s?void 0:s.error)||(null==s?void 0:s.status))))}else await fetch("/api/regular/unregister",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})}),_(e=>(e?e+" • ":"")+"Расписание отключено")}catch(e){_(s=>(s?s+" • ":"")+"Расписание исключение: ".concat(String((null==e?void 0:e.message)||e)))}O(!1),l(t)}let S=f.watch("assignee"),Z=f.watch("creator");function I(e){return c.find(s=>s.id===e)}return(0,t.jsxs)("form",{className:"space-y-6",onSubmit:f.handleSubmit(C),children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Введите название задачи"}),(0,t.jsx)("input",{type:"text",className:"w-full rounded-xl border px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300",...f.register("title"),placeholder:"Название"})]}),(0,t.jsx)("div",{children:(0,t.jsx)("textarea",{className:"w-full min-h-36 rounded-xl border px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-300",placeholder:"Описание задачи",...f.register("description")})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"px-2 py-1 rounded-lg bg-gray-100",children:"CoPilot"}),(0,t.jsx)("button",{type:"button",className:"px-2 py-1 rounded-lg hover:bg-gray-100",onClick:()=>{let e=prompt("Текст пункта чек-листа");if(e){let s=f.getValues("checklist")||[];f.setValue("checklist",[...s,{id:crypto.randomUUID(),text:e,done:!1}])}},children:"Чек-лист"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Исполнитель (основной)"}),u?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Загружаю пользователей…"}):v?(0,t.jsxs)("div",{className:"text-sm text-red-600",children:["Ошибка: ",v]}):(0,t.jsx)("select",{className:"w-full rounded-xl border px-3 py-2",value:(null==S?void 0:S.id)||"0",onChange:e=>f.setValue("assignee",I(e.target.value)||j),children:[j,...c].map(e=>(0,t.jsx)("option",{value:e.id,children:(e.name||"").trim()||e.email||"Без имени"},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Постановщик"}),u?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Загружаю пользователей…"}):v?(0,t.jsxs)("div",{className:"text-sm text-red-600",children:["Ошибка: ",v]}):(0,t.jsx)("select",{className:"w-full rounded-xl border px-3 py-2",value:(null==Z?void 0:Z.id)||"me",onChange:e=>f.setValue("creator",I(e.target.value)||y),children:c.map(e=>(0,t.jsx)("option",{value:e.id,children:(e.name||"").trim()||e.email||"Без имени"},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-2",children:"Исполнители (можно несколько)"}),u?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Загружаю пользователей…"}):v?(0,t.jsxs)("div",{className:"text-sm text-red-600",children:["Ошибка: ",v]}):(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:c.map(e=>{let s=!!(f.getValues("assignees")||[]).find(s=>s.id===e.id);return(0,t.jsxs)("label",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:s,onChange:s=>{let l=f.getValues("assignees")||[],t=s.target.checked?[...l,e]:l.filter(s=>s.id!==e.id);f.setValue("assignees",t),t.length>0?f.setValue("assignee",t[0]):f.setValue("assignee",j)}}),(0,t.jsx)("span",{children:e.name||e.email||"Без имени"})]},e.id)})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Крайний срок"}),(0,t.jsx)("input",{type:"datetime-local",className:"w-full rounded-xl border px-3 py-2",...f.register("dueDate")})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-6",children:[(0,t.jsx)("input",{type:"checkbox",className:"size-4",...f.register("isImportant")}),(0,t.jsx)("span",{children:"Это важная задача"})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"checkbox",className:"size-4",...f.register("repeatRule.isRecurring")}),(0,t.jsx)("span",{className:"font-medium",children:"Сделать задачу регулярной"}),(0,t.jsx)("span",{className:"ml-auto text-xs text-gray-500",children:"Повторение: каждый день"})]}),f.watch("repeatRule.isRecurring")&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Время создания задачи"}),(0,t.jsx)("input",{type:"time",className:"w-full rounded-xl border px-3 py-2",...f.register("repeatRule.timeOfDay")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Начинать повторение (поле)"}),(0,t.jsx)("input",{type:"date",className:"w-full rounded-xl border px-3 py-2",...f.register("repeatRule.startsAt")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Повторять до (поле)"}),(0,t.jsx)("input",{type:"text",placeholder:"например, без даты окончания",className:"w-full rounded-xl border px-3 py-2",...f.register("repeatRule.endsAtRaw")})]})]})]}),b.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Чек-лист"}),(0,t.jsx)("ul",{className:"space-y-2",children:b.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",className:"size-4",checked:f.getValues("checklist.".concat(s,".done")),onChange:l=>w(s,{...e,done:l.target.checked})}),(0,t.jsx)("input",{className:"flex-1 rounded-lg border px-3 py-1",value:f.getValues("checklist.".concat(s,".text")),onChange:l=>w(s,{...e,text:l.target.value})}),(0,t.jsx)("button",{type:"button",className:"text-red-600 hover:underline",onClick:()=>k(s),children:"Удалить"})]},e.id))})]}),R&&(0,t.jsx)("div",{className:"text-sm text-gray-600",children:R}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 rounded-xl border hover:bg-gray-50",children:"Отмена"}),(0,t.jsx)("button",{type:"submit",disabled:D,className:"px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:D?"Сохраняю...":"Сохранить"})]})]})}var v=l(6235);function g(e){return(0,v.WU)(e,"dd.MM.yyyy HH:mm")}function j(e){if(!e)return null;let[s,l]=e.split(":").map(e=>parseInt(e,10)),t=new Date,i=new Date;return i.setHours(s,l,0,0),i<=t&&i.setDate(i.getDate()+1),i}function y(e){var s,l,i,a,n,d;let{task:r,onClick:c}=e,o=(null===(s=r.repeatRule)||void 0===s?void 0:s.isRecurring)&&r.repeatRule.timeOfDay?j(r.repeatRule.timeOfDay):null;return(0,t.jsxs)("div",{onClick:c,className:"w-[450px] h-[450px] bg-white rounded-2xl shadow hover:shadow-lg transition-shadow border cursor-pointer flex flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b flex items-start gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg line-clamp-2",children:r.title||"Без названия"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2 mt-1",children:r.description})]}),(null===(l=r.repeatRule)||void 0===l?void 0:l.isRecurring)&&(0,t.jsx)("span",{className:"inline-block text-xs px-2 py-1 rounded-full bg-brand-100 text-brand-700",children:"Регулярная"})]}),(0,t.jsxs)("div",{className:"p-4 space-y-3 text-sm flex-1",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Исполнитель"}),(0,t.jsx)("span",{className:"font-medium",children:(null===(i=r.assignee)||void 0===i?void 0:i.name)||(null===(a=r.assignee)||void 0===a?void 0:a.email)||"—"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Постановщик"}),(0,t.jsx)("span",{className:"",children:(null===(n=r.creator)||void 0===n?void 0:n.name)||(null===(d=r.creator)||void 0===d?void 0:d.email)||"—"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Создана"}),(0,t.jsx)("span",{children:g(new Date(r.createdAt))})]}),r.dueDate&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Крайний срок"}),(0,t.jsx)("span",{className:"font-medium",children:g(new Date(r.dueDate))})]}),o&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Следующее создание"}),(0,t.jsx)("span",{className:"font-medium",children:g(o)})]})]}),(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 mt-auto text-xs text-gray-600",children:"Кликните, чтобы открыть полные данные"})]})}function f(e){var s,l,i,a,n,d,r,c;let{task:o}=e,u=(null===(s=o.repeatRule)||void 0===s?void 0:s.isRecurring)&&o.repeatRule.timeOfDay?j(o.repeatRule.timeOfDay):null;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Название задачи"}),(0,t.jsx)("div",{className:"text-lg font-semibold",children:o.title})]}),o.description&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Описание"}),(0,t.jsx)("div",{className:"whitespace-pre-wrap",children:o.description})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Исполнитель"}),(0,t.jsx)("div",{children:(null===(l=o.assignee)||void 0===l?void 0:l.name)||(null===(i=o.assignee)||void 0===i?void 0:i.email)||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Постановщик"}),(0,t.jsx)("div",{children:(null===(a=o.creator)||void 0===a?void 0:a.name)||(null===(n=o.creator)||void 0===n?void 0:n.email)||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Создана"}),(0,t.jsx)("div",{children:g(new Date(o.createdAt))})]}),o.dueDate&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Крайний срок"}),(0,t.jsx)("div",{children:g(new Date(o.dueDate))})]})]}),(0,t.jsxs)("div",{className:"rounded-xl border p-3",children:[(0,t.jsx)("div",{className:"font-medium mb-2",children:"Регулярность"}),(0,t.jsx)("div",{className:"text-sm",children:(null===(d=o.repeatRule)||void 0===d?void 0:d.isRecurring)?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{children:["Каждый день в ",o.repeatRule.timeOfDay]}),u&&(0,t.jsxs)("div",{children:["Следующее создание: ",(0,t.jsx)("span",{className:"font-medium",children:g(u)})]}),o.repeatRule.startsAt&&(0,t.jsxs)("div",{children:["Начинать повторение: ",o.repeatRule.startsAt]}),o.repeatRule.endsAtRaw&&(0,t.jsxs)("div",{children:["Повторять до: ",o.repeatRule.endsAtRaw]})]}):(0,t.jsx)("div",{className:"text-gray-500",children:"Не регулярная"})})]}),(null===(r=o.checklist)||void 0===r?void 0:r.length)?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium mb-2",children:"Чек-лист"}),(0,t.jsx)("ul",{className:"space-y-1",children:o.checklist.map(e=>(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.done,readOnly:!0,className:"size-4"}),(0,t.jsx)("span",{className:e.done?"line-through text-gray-500":"",children:e.text})]},e.id))})]}):null,(null===(c=o.attachments)||void 0===c?void 0:c.length)?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium mb-2",children:"Вложения (псевдо)"}),(0,t.jsx)("ul",{className:"list-disc pl-5 text-sm",children:o.attachments.map(e=>(0,t.jsx)("li",{children:e.name},e.id))})]}):null]})}function b(){let e=x(e=>e.tasks),s=x(e=>e.remove),l=x(e=>e.getById),[n,d]=(0,i.useState)(!1),[r,c]=(0,i.useState)(null),o=(0,i.useMemo)(()=>r&&!r.startsWith("edit:")?l(r):void 0,[r,l]);return(0,t.jsxs)("main",{className:"container-page py-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Новая задача"}),(0,t.jsx)("button",{onClick:()=>d(!0),className:"px-4 py-2 rounded-2xl bg-brand-600 text-white hover:bg-brand-700 shadow",children:"Создать"})]}),(0,t.jsx)("div",{className:"grid gap-6 grid-cols-[repeat(auto-fill,minmax(450px,1fr))]",children:e.map(e=>(0,t.jsx)(y,{task:e,onClick:()=>c(e.id)},e.id))}),(0,t.jsx)(a,{open:n,onClose:()=>d(!1),title:"Создать задачу",size:"xl",children:(0,t.jsx)(h,{onSaved:e=>{d(!1),c(e)},onCancel:()=>d(!1)})}),(0,t.jsx)(a,{open:!!o,onClose:()=>c(null),title:o?"Задача: ".concat(o.title):"Задача",size:"xl",children:o&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(f,{task:o}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-3",children:[(0,t.jsx)("button",{onClick:()=>c("edit:"+o.id),className:"px-4 py-2 rounded-xl border hover:bg-gray-50",children:"Редактировать"}),(0,t.jsx)("button",{onClick:async()=>{confirm("Удалить задачу?")&&(await fetch("/api/regular/unregister",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o.id})}),s(o.id),c(null))},className:"px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700",children:"Удалить"})]})]})}),(0,t.jsx)(a,{open:"string"==typeof r&&r.startsWith("edit:"),onClose:()=>c(null),title:"Редактировать задачу",size:"xl",children:"string"==typeof r&&r.startsWith("edit:")&&(0,t.jsx)(h,{initial:l(r.slice(5)),onSaved:e=>c(e),onCancel:()=>c(null)})})]})}}},function(e){e.O(0,[632,971,23,744],function(){return e(e.s=7849)}),_N_E=e.O()}]);